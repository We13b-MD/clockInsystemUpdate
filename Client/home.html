<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - MikiClock</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axe-core/4.10.0/axe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axe-core/4.7.2/axe.min.js"></script>
    
    <script type="text/javascript">
        window.tailwind.config = {
            darkMode: ['class'],
            theme: {
                extend: {
                    colors: {
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        ring: 'hsl(var(--ring))',
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        primary: {
                            DEFAULT: 'hsl(var(--primary))',
                            foreground: 'hsl(var(--primary-foreground))'
                        },
                        secondary: {
                            DEFAULT: 'hsl(var(--secondary))',
                            foreground: 'hsl(var(--secondary-foreground))'
                        },
                        destructive: {
                            DEFAULT: 'hsl(var(--destructive))',
                            foreground: 'hsl(var(--destructive-foreground))'
                        },
                        muted: {
                            DEFAULT: 'hsl(var(--muted))',
                            foreground: 'hsl(var(--muted-foreground))'
                        },
                        accent: {
                            DEFAULT: 'hsl(var(--accent))',
                            foreground: 'hsl(var(--accent-foreground))'
                        },
                        popover: {
                            DEFAULT: 'hsl(var(--popover))',
                            foreground: 'hsl(var(--popover-foreground))'
                        },
                        card: {
                            DEFAULT: 'hsl(var(--card))',
                            foreground: 'hsl(var(--card-foreground))'
                        },
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            :root {
                --background: 0 0% 100%;
                --foreground: 224 71.4% 4.1%;
                --card: 0 0% 100%;
                --card-foreground: 224 71.4% 4.1%;
                --popover: 0 0% 100%;
                --popover-foreground: 224 71.4% 4.1%;
                --primary: 220.9 39.3% 11%;
                --primary-foreground: 210 20% 98%;
                --secondary: 220 14.3% 95.9%;
                --secondary-foreground: 220.9 39.3% 11%;
                --muted: 220 14.3% 95.9%;
                --muted-foreground: 220 8.9% 46.1%;
                --accent: 220 14.3% 95.9%;
                --accent-foreground: 220.9 39.3% 11%;
                --destructive: 0 84.2% 60.2%;
                --destructive-foreground: 210 20% 98%;
                --border: 220 13% 91%;
                --input: 220 13% 91%;
                --ring: 224 71.4% 4.1%;
                --radius: 0.35rem;
            }
            .dark {
                --background: 224 71.4% 4.1%;
                --foreground: 210 20% 98%;
                --card: 224 71.4% 4.1%;
                --card-foreground: 210 20% 98%;
                --popover: 224 71.4% 4.1%;
                --popover-foreground: 210 20% 98%;
                --primary: 210 20% 98%;
                --primary-foreground: 220.9 39.3% 11%;
                --secondary: 215 27.9% 16.9%;
                --secondary-foreground: 210 20% 98%;
                --muted: 215 27.9% 16.9%;
                --muted-foreground: 217.9 10.6% 64.9%;
                --accent: 215 27.9% 16.9%;
                --accent-foreground: 210 20% 98%;
                --destructive: 0 62.8% 30.6%;
                --destructive-foreground: 210 20% 98%;
                --border: 215 27.9% 16.9%;
                --input: 215 27.9% 16.9%;
                --ring: 216 12.2% 83.9%;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar - Hidden on mobile, shown on tablet/desktop -->
        <div class="bg-blue-900 text-white w-full md:w-64 md:flex-shrink-0 md:block hidden" id="sidebar">
            <div class="p-4">
                <h2 class="text-2xl font-bold mb-8">MikiClock</h2>
                <nav>
                    <ul>
                        <li class="mb-2">
                            <a href="#" class="flex items-center p-3 rounded-md bg-blue-800 hover:bg-blue-700">
                                <i class="fas fa-home mr-3"></i>
                                <span>Home</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="dashboard.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-tachometer-alt mr-3"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="admin.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-users-cog mr-3"></i>
                                <span>Admin Panel</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="timehistory.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-history mr-3"></i>
                                <span>Time History</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="forum.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-comments mr-3"></i>
                                <span>Forum</span>
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="settings.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                <i class="fas fa-cog mr-3"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="mt-auto p-4 border-t border-blue-800">
                <a href="form.html" id="logout-link" class="flex items-center p-2 rounded-md hover:bg-blue-700">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1">
            <!-- Mobile Top Bar -->
            <div class="bg-blue-900 text-white p-4 flex justify-between items-center md:hidden">
                <h2 class="text-xl font-bold">MikiClock</h2>
                <button id="menuToggle" class="text-white focus:outline-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <!-- Mobile Sidebar (Hidden by default) -->
            <div class="bg-blue-900 text-white w-full hidden" id="mobileSidebar">
                <div class="p-4">
                    <nav>
                        <ul>
                            <li class="mb-2">
                                <a href="#" class="flex items-center p-3 rounded-md bg-blue-800 hover:bg-blue-700">
                                    <i class="fas fa-home mr-3"></i>
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="dashboard.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-tachometer-alt mr-3"></i>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="admin.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-users-cog mr-3"></i>
                                    <span>Admin Panel</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="timehistory.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-history mr-3"></i>
                                    <span>Time History</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="forum.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-comments mr-3"></i>
                                    <span>Forum</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="settings.html" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-cog mr-3"></i>
                                    <span>Settings</span>
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="form.html" id="logout-link-mobile" class="flex items-center p-3 rounded-md hover:bg-blue-700">
                                    <i class="fas fa-sign-out-alt mr-3"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-4 md:p-8">
                <!-- Header with Current Time -->
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800">Welcome Home, <span id="userName">User</span></h1>
                    <div class="text-lg font-semibold" id="currentTime">
                        <span id="currentDate"></span> | <span id="clock"></span>
                    </div>
                </div>

                <!-- Welcome Banner -->
                <div class="bg-gradient-to-r from-blue-900 to-blue-700 text-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex flex-col md:flex-row items-center">
                        <div class="flex-1 mb-4 md:mb-0">
                            <h2 class="text-3xl font-bold mb-2">Welcome to MikiClock</h2>
                            <p class="text-blue-100 text-lg">Your comprehensive employee time management system</p>
                        </div>
                        <div class="text-6xl opacity-20">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>

                <!-- Quick Clock Action -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex flex-col md:flex-row items-center justify-between">
                        <div class="mb-4 md:mb-0">
                            <h3 class="text-xl font-bold mb-2">Quick Clock Action</h3>
                            <p class="text-gray-600">Current Status: <span id="quickClockStatus" class="font-semibold">Loading...</span></p>
                        </div>
                        <div class="flex space-x-4">
                            <button id="quickClockInBtn" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-300 hidden">
                                <i class="fas fa-play mr-2"></i>Clock In
                            </button>
                            <button id="quickClockOutBtn" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition duration-300 hidden">
                                <i class="fas fa-stop mr-2"></i>Clock Out
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow duration-300">
                        <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-tachometer-alt text-blue-800 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Dashboard</h3>
                        <p class="text-gray-600 text-sm mb-4">View your clock status and recent activity</p>
                        <a href="dashboard.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition duration-300 inline-block">
                            Go to Dashboard
                        </a>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow duration-300">
                        <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-history text-green-800 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Time History</h3>
                        <p class="text-gray-600 text-sm mb-4">Review your complete time tracking records</p>
                        <a href="timehistory.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition duration-300 inline-block">
                            View History
                        </a>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow duration-300">
                        <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-comments text-purple-800 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Forum</h3>
                        <p class="text-gray-600 text-sm mb-4">Connect and communicate with colleagues</p>
                        <a href="forum.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition duration-300 inline-block">
                            Visit Forum
                        </a>
                    </div>

                    <div class="bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow duration-300">
                        <div class="bg-gray-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-cog text-gray-800 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Settings</h3>
                        <p class="text-gray-600 text-sm mb-4">Customize your profile and preferences</p>
                        <a href="settings.html" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-900 transition duration-300 inline-block">
                            Manage Settings
                        </a>
                    </div>
                </div>

                <!-- Today's Summary -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Current Status Card -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold">Today's Status</h3>
                            <i class="fas fa-calendar-day text-blue-800 text-xl"></i>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Current Status:</span>
                                <span class="font-semibold" id="homeClockStatus">
                                    <span class="text-gray-500">
                                        <i class="fas fa-circle text-xs mr-2"></i>Loading...
                                    </span>
                                </span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Hours Today:</span>
                                <span class="font-semibold text-blue-800" id="homeTodayHours">--</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                <span class="text-gray-600">Clock In Time:</span>
                                <span class="font-semibold" id="homeClockInTime">--:-- --</span>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <a href="dashboard.html" class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-900 transition duration-300 flex items-center justify-center">
                                <i class="fas fa-external-link-alt mr-2"></i>
                                Go to Full Dashboard
                            </a>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold">Quick Stats</h3>
                            <i class="fas fa-chart-bar text-blue-800 text-xl"></i>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <div class="text-2xl font-bold text-blue-800" id="weeklyHours">--</div>
                                <div class="text-sm text-gray-600">This Week</div>
                            </div>
                            
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-800" id="monthlyDays">--</div>
                                <div class="text-sm text-gray-600">Days This Month</div>
                            </div>
                            
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-800" id="avgDaily">--</div>
                                <div class="text-sm text-gray-600">Avg Daily Hours</div>
                            </div>
                            
                            <div class="text-center p-4 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-800" id="totalRecords">--</div>
                                <div class="text-sm text-gray-600">Total Records</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Updates & Announcements -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold">Recent Updates</h3>
                        <i class="fas fa-bullhorn text-blue-800 text-xl"></i>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="border-l-4 border-blue-800 pl-4 py-2">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">System Update</h4>
                                <span class="text-sm text-gray-500">Today</span>
                            </div>
                            <p class="text-gray-600 mt-1">MikiClock has been updated with improved performance and new features.</p>
                        </div>
                        
                        <div class="border-l-4 border-green-600 pl-4 py-2">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">New Forum Feature</h4>
                                <span class="text-sm text-gray-500">2 days ago</span>
                            </div>
                            <p class="text-gray-600 mt-1">Enhanced communication features now available in the Forum section.</p>
                        </div>
                        
                        <div class="border-l-4 border-purple-600 pl-4 py-2">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-gray-800">Time Tracking Enhancement</h4>
                                <span class="text-sm text-gray-500">1 week ago</span>
                            </div>
                            <p class="text-gray-600 mt-1">Improved accuracy and better reporting in time tracking system.</p>
                        </div>
                    </div>
                </div>

                <!-- Footer Info -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="text-center">
                        <h3 class="text-lg font-bold mb-2">Need Help?</h3>
                        <p class="text-gray-600 mb-4">If you have any questions or need assistance with the system, please contact your administrator.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <button class="bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition duration-300" onclick="showHelpDialog()">
                                <i class="fas fa-question-circle mr-2"></i>
                                Get Help
                            </button>
                            <a href="forum.html" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition duration-300 text-center">
                                <i class="fas fa-comments mr-2"></i>
                                Contact Support
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="results-content"></div>
    </div>

    <script>
        let currentUser = null;
        let updateInterval = null;

        // Display current time and date
        function updateClock() {
            const now = new Date();
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
                    
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        // Mobile menu toggle
        document.getElementById('menuToggle').addEventListener('click', function() {
            const mobileSidebar = document.getElementById('mobileSidebar');
            mobileSidebar.classList.toggle('hidden');
            
            // Toggle icon
            const icon = this.querySelector('i');
            if (mobileSidebar.classList.contains('hidden')) {
                icon.className = 'fas fa-bars';
            } else {
                icon.className = 'fas fa-times';
            }
        });

        // Close mobile sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const mobileSidebar = document.getElementById('mobileSidebar');
            const menuToggle = document.getElementById('menuToggle');
            
            if (!mobileSidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                mobileSidebar.classList.add('hidden');
                menuToggle.querySelector('i').className = 'fas fa-bars';
            }
        });

        // Utility Functions
        function formatTime(date) {
            if (!date) return '--:-- --';
            
            const d = new Date(date);
            const hours = d.getHours();
            const minutes = d.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const formattedHours = hours % 12 || 12;
            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
            
            return `${formattedHours}:${formattedMinutes} ${ampm}`;
        }

        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return '--';
            
            const start = new Date(startTime);
            const end = new Date(endTime);
            const diff = end - start;
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${hours}h ${minutes}m`;
        }

        function calculateHours(startTime, endTime) {
            if (!startTime || !endTime) return 0;
            const start = new Date(startTime);
            const end = new Date(endTime);
            return (end - start) / (1000 * 60 * 60);
        }

        function getTodayString() {
            return new Date().toLocaleDateString('en-US');
        }

        function getStartOfWeek() {
            const now = new Date();
            const day = now.getDay();
            const diff = now.getDate() - day;
            return new Date(now.setDate(diff));
        }

        function getStartOfMonth() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), 1);
        }

        // Clock In/Out Functions
        function clockIn() {
            const clockRecords = JSON.parse(localStorage.getItem('clockRecords')) || [];
            const today = getTodayString();
            
            // Check if user is already clocked in today
            const existingRecord = clockRecords.find(record => 
                record.employeeId === currentUser.employeeId && 
                new Date(record.date).toLocaleDateString('en-US') === today && 
                !record.clockOut
            );
            
            if (existingRecord) {
                Swal.fire('Already Clocked In', 'You are already clocked in for today.', 'warning');
                return;
            }

            const newRecord = {
                id: Date.now().toString(),
                employeeId: currentUser.employeeId,
                employeeName: currentUser.name,
                date: new Date().toISOString(),
                clockIn: new Date().toISOString(),
                clockOut: null,
                totalHours: null,
                notes: ''
            };

            clockRecords.push(newRecord);
            localStorage.setItem('clockRecords', JSON.stringify(clockRecords));
            
            Swal.fire('Success', 'Clocked in successfully!', 'success');
            updateHomeDashboard();
        }

        function clockOut() {
            const clockRecords = JSON.parse(localStorage.getItem('clockRecords')) || [];
            const today = getTodayString();
            
            const activeRecord = clockRecords.find(record => 
                record.employeeId === currentUser.employeeId && 
                new Date(record.date).toLocaleDateString('en-US') === today && 
                !record.clockOut
            );
            
            if (!activeRecord) {
                Swal.fire('Not Clocked In', 'You need to clock in first.', 'warning');
                return;
            }

            const clockOutTime = new Date().toISOString();
            activeRecord.clockOut = clockOutTime;
            activeRecord.totalHours = calculateHours(activeRecord.clockIn, clockOutTime);

            localStorage.setItem('clockRecords', JSON.stringify(clockRecords));
            
            Swal.fire('Success', 'Clocked out successfully!', 'success');
            updateHomeDashboard();
        }

        // Update home dashboard with user's current status
        function updateHomeDashboard() {
            if (!currentUser) return;

            const clockRecords = JSON.parse(localStorage.getItem('clockRecords')) || [];
            const userRecords = clockRecords.filter(record => record.employeeId === currentUser.employeeId);
            
            // Get today's active session
            const today = getTodayString();
            const todayActiveRecord = userRecords.find(record => 
                new Date(record.date).toLocaleDateString('en-US') === today && !record.clockOut
            );

            // Update status displays
            const homeClockStatus = document.getElementById('homeClockStatus');
            const homeTodayHours = document.getElementById('homeTodayHours');
            const homeClockInTime = document.getElementById('homeClockInTime');
            const quickClockStatus = document.getElementById('quickClockStatus');
            const quickClockInBtn = document.getElementById('quickClockInBtn');
            const quickClockOutBtn = document.getElementById('quickClockOutBtn');

            if (todayActiveRecord) {
                // User is currently clocked in
                homeClockStatus.innerHTML = '<span class="text-green-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked In</span>';
                quickClockStatus.innerHTML = '<span class="text-green-500"><i class="fas fa-circle text-xs mr-2"></i>Currently Clocked In</span>';
                homeClockInTime.textContent = formatTime(new Date(todayActiveRecord.clockIn));
                
                // Calculate current hours (live update)
                const currentTime = new Date();
                homeTodayHours.textContent = calculateDuration(todayActiveRecord.clockIn, currentTime);
                
                // Show clock out button, hide clock in button
                quickClockInBtn.classList.add('hidden');
                quickClockOutBtn.classList.remove('hidden');
            } else {
                // Check if user has completed records for today
                const todayCompletedRecord = userRecords.find(record => 
                    new Date(record.date).toLocaleDateString('en-US') === today && record.clockOut
                );
                
                if (todayCompletedRecord) {
                    // User has clocked out for today
                    homeClockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Clocked Out</span>';
                    quickClockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Completed for Today</span>';
                    homeClockInTime.textContent = formatTime(new Date(todayCompletedRecord.clockIn));
                    homeTodayHours.textContent = calculateDuration(todayCompletedRecord.clockIn, todayCompletedRecord.clockOut);
                    
                    // Show clock in button for new session, hide clock out
                    quickClockInBtn.classList.remove('hidden');
                    quickClockOutBtn.classList.add('hidden');
                } else {
                    // User hasn't clocked in today
                    homeClockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Not Clocked In</span>';
                    quickClockStatus.innerHTML = '<span class="text-gray-500"><i class="fas fa-circle text-xs mr-2"></i>Ready to Clock In</span>';
                    homeClockInTime.textContent = '--:-- --';
                    homeTodayHours.textContent = '--';
                    
                    // Show clock in button, hide clock out
                    quickClockInBtn.classList.remove('hidden');
                    quickClockOutBtn.classList.add('hidden');
                }
            }

            // Update quick stats
            updateQuickStats(userRecords);
        }

        // Calculate and display quick stats
        function updateQuickStats(userRecords) {
            const now = new Date();
            const startOfWeek = getStartOfWeek();
            const startOfMonth = getStartOfMonth();

            // Initialize counters
            let weeklyHours = 0;
            let monthlyDays = 0;
            let totalHours = 0;
            let completedRecords = 0;

            userRecords.forEach(record => {
                const recordDate = new Date(record.date);
                
                if (record.clockOut) {
                    const hours = calculateHours(record.clockIn, record.clockOut);
                    totalHours += hours;
                    completedRecords++;
                    
                    // This week's hours
                    if (recordDate >= startOfWeek) {
                        weeklyHours += hours;
                    }
                    
                    // This month's working days
                    if (recordDate >= startOfMonth) {
                        monthlyDays++;
                    }
                } else if (record.clockIn) {
                    // Include current active session in weekly calculation
                    const recordDateStr = new Date(record.date).toLocaleDateString('en-US');
                    const todayStr = getTodayString();
                    
                    if (recordDateStr === todayStr && recordDate >= startOfWeek) {
                        const currentHours = calculateHours(record.clockIn, new Date().toISOString());
                        weeklyHours += currentHours;
                    }
                }
            });

            // Update displays
            document.getElementById('weeklyHours').textContent = Math.round(weeklyHours * 10) / 10 + 'h';
            document.getElementById('monthlyDays').textContent = monthlyDays;
            document.getElementById('avgDaily').textContent = completedRecords > 0 ? 
                Math.round((totalHours / completedRecords) * 10) / 10 + 'h' : '--';
            document.getElementById('totalRecords').textContent = userRecords.length;
        }

        // Logout function
        function logoutUser() {
            Swal.fire({
                title: 'Are you sure?',
                text: 'You will be logged out of the system.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, logout'
            }).then((result) => {
                if (result.isConfirmed) {
                    sessionStorage.removeItem('loggedInUser');
                    window.location.href = 'form.html';
                }
            });
        }

        // Help dialog function
        function showHelpDialog() {
            Swal.fire({
                title: 'Help & Support',
                html: `
                    <div class="text-left">
                        <h4 class="font-bold mb-2">Getting Started:</h4>
                        <ul class="list-disc list-inside mb-4 text-sm">
                            <li>Use the quick clock buttons to clock in/out</li>
                            <li>View your dashboard for detailed time tracking</li>
                            <li>Check time history for past records</li>
                            <li>Use the forum to communicate with colleagues</li>
                        </ul>
                        
                        <h4 class="font-bold mb-2">Common Issues:</h4>
                        <ul class="list-disc list-inside text-sm">
                            <li>If clock buttons don't work, refresh the page</li>
                            <li>Make sure you're clocked out before leaving</li>
                            <li>Contact admin for any data discrepancies</li>
                        </ul>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Got it!',
                width: '600px'
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            
            if (!loggedInUser) {
                window.location.href = 'form.html';
                return;
            }

            // Get user data
            const users = JSON.parse(localStorage.getItem('users')) || [];
            currentUser = users.find(user => user.name === loggedInUser);
            
            if (!currentUser) {
                Swal.fire('Error', 'User data not found. Please login again.', 'error')
                    .then(() => {
                        sessionStorage.removeItem('loggedInUser');
                        window.location.href = 'form.html';
                    });
                return;
            }

            // Update user name in welcome message
            document.getElementById('userName').textContent = currentUser.name;

            // Initialize dashboard
            updateHomeDashboard();

            // Set up clock update
            updateClock();
            setInterval(updateClock, 1000);

            // Set up dashboard refresh for live hours update
            updateInterval = setInterval(() => {
                if (currentUser) {
                    updateHomeDashboard();
                }
            }, 30000); // Update every 30 seconds

            // Quick clock button event listeners
            document.getElementById('quickClockInBtn').addEventListener('click', clockIn);
            document.getElementById('quickClockOutBtn').addEventListener('click', clockOut);

            // Logout functionality
            const logoutLinks = document.querySelectorAll('[id^="logout-link"]');
            logoutLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    logoutUser();
                });
            });
        });

        // Clean up intervals when page unloads
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });

        // Listen for storage changes (when user clocks in/out from other pages)
        window.addEventListener('storage', function(e) {
            if (e.key === 'clockRecords' && currentUser) {
                updateHomeDashboard();
            }
        });



        // Accessibility tests

         async function runAccessibilityTests() {
    const resultsDiv = document.getElementById('results-content');
    
    // Safety check to ensure the results container exists
    if (!resultsDiv) {
        console.error('Results container not found. Make sure an element with id="results-content" exists.');
        return;
    }
    
    try {
        // Run axe-core against the sidebar navigation (using the ID selector)
        const results = await axe.run('#sidebar');
        
        // Display results
        let html = '';
        
        // Violations
        if (results.violations.length === 0) {
           
        } else {
            html += '<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">';
            html += `<p class="font-bold">✗ Found ${results.violations.length} violations:</p>`;
            html += '<ul class="list-disc ml-5 mt-2">';
            results.violations.forEach(violation => {
                html += `<li class="mb-2">`;
                html += `<strong>${violation.id}</strong>: ${violation.description}`;
                html += `<br><span class="text-sm">Impact: ${violation.impact}</span>`;
                html += `<br><span class="text-sm">Affected elements: ${violation.nodes.length}</span>`;
                html += `</li>`;
            });
            html += '</ul></div>';
        }
        
        // Passes
        html += '<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4">';
       // html += `<p class="font-bold">✓ Passed ${results.passes.length} checks</p>`;
        //html += '<details class="mt-2"><summary class="cursor-pointer">View passed checks</summary>';
        //html += '<ul class="list-disc ml-5 mt-2">';
       /* results.passes.forEach(pass => {
            html += `<li class="text-sm">${pass.id}: ${pass.description}</li>`;
        });
        html += '</ul></details></div>';*/
        
        // Incomplete
        /*if (results.incomplete.length > 0) {
            html += '<div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">';
            html += `<p class="font-bold">⚠ ${results.incomplete.length} incomplete checks (need manual review)</p>`;
            html += '<ul class="list-disc ml-5 mt-2">';
            results.incomplete.forEach(incomplete => {
                html += `<li class="text-sm">${incomplete.id}: ${incomplete.description}</li>`;
            });
            html += '</ul></div>';
        }*/
        
        // Summary
        /*html += '<div class="bg-gray-100 p-4 rounded">';
        html += '<h3 class="font-semibold mb-2">Summary</h3>';
        html += `<p>Total tests run: ${results.passes.length + results.violations.length + results.incomplete.length}</p>`;
        html += `<p>Violations: ${results.violations.length}</p>`;
        html += `<p>Passes: ${results.passes.length}</p>`;
        html += `<p>Incomplete: ${results.incomplete.length}</p>`;
        html += '</div>';*/
        
       // resultsDiv.innerHTML = html;
        
        // Log to console for detailed inspection
        console.log('Accessibility Test Results:', results);
        
    } catch (error) {
        resultsDiv.innerHTML = `
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                <p class="font-bold">Error running tests:</p>
                <p>${error.message}</p>
            </div>
        `;
        console.error('Accessibility testing error:', error);
    }
}

// Run tests when page loads
window.addEventListener('load', runAccessibilityTests);
        // Run tests when page loads
        window.addEventListener('load', runAccessibilityTests);
       

        
     
    </script>
</body>
</html>
